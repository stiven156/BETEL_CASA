{% load formatos %}
<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{{ ajustes.nombre_marca|default:"Betel Casa de Dios" }}</title>

  <style>
    :root{
      --bg:#f7f7f8;
      --card:#ffffff;
      --text:#0f0f10;
      --muted:#5f5f66;
      --line:#e6e6ea;
      --black:#000;
    }
    body{margin:0;font-family:Arial,Helvetica,sans-serif;background:var(--bg);color:var(--text)}
    a{color:inherit}
    .wrap{max-width:1100px;margin:0 auto;padding:22px}
    .top{display:flex;align-items:center;justify-content:space-between;gap:14px}
    .brand{display:flex;align-items:center;gap:12px}
    .brand img{height:44px}
    .filters{display:flex;flex-wrap:wrap;gap:10px;margin-top:16px}
    .label{font-size:12px;color:var(--muted);padding:8px 10px;border:1px solid var(--line);border-radius:999px;background:#fff}
    .chip{
      border:1px solid var(--line); background:#fff; color:var(--text);
      padding:9px 12px; border-radius:999px; text-decoration:none; font-size:13px;
    }
    .chip.active{border-color:var(--black)}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:16px;margin-top:18px}
    .card{
      background:var(--card); border:1px solid var(--line); border-radius:16px; overflow:hidden;
      text-decoration:none; box-shadow:0 6px 18px rgba(0,0,0,.06);
      transition:transform .12s ease, box-shadow .12s ease;
    }
    .card:hover{transform:translateY(-2px); box-shadow:0 10px 24px rgba(0,0,0,.10)}
    /* Fondo CLARO para que camisetas negras se vean */
    .imgbox{background:#fff; padding:10px}
    .card img{width:100%;height:260px;object-fit:cover;border-radius:12px;border:1px solid var(--line);background:#fff}
    .p{padding:12px}
    .title{margin:0 0 6px 0;font-weight:800}
    .price{margin:0;color:var(--muted);font-size:13px}
    .section{margin-top:22px;background:var(--card);border:1px solid var(--line);border-radius:16px;padding:14px}
    .section h3{margin:0 0 8px 0}
    .section p{margin:0;color:var(--muted);line-height:1.6;font-size:13px;white-space:pre-line}
    .footer{margin-top:22px;border-top:1px solid var(--line);padding-top:16px;color:var(--muted);font-size:12px;line-height:1.6}
    .wpp{
      position:fixed;right:18px;bottom:18px;
      background:#000;color:#fff;text-decoration:none;
      padding:13px 16px;border-radius:999px;font-weight:800;
    }

    /* Modal T&C obligatorio */
    .modal-back{position:fixed;inset:0;background:rgba(0,0,0,.55);display:none;align-items:center;justify-content:center;padding:18px;z-index:9999}
    .modal{max-width:760px;width:100%;background:#fff;border:1px solid var(--line);border-radius:16px;padding:16px}
    .modal h2{margin:0 0 8px 0}
    .modal .txt{max-height:52vh;overflow:auto;border:1px solid var(--line);border-radius:12px;padding:12px;color:var(--muted);white-space:pre-line}
    .row{display:flex;gap:10px;justify-content:flex-end;margin-top:12px}
    .btn{border:1px solid var(--line);background:#fff;color:var(--text);padding:10px 12px;border-radius:12px;font-weight:700;cursor:pointer}
    .btn.primary{background:#000;color:#fff;border-color:#000}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <div class="brand">
        {% if ajustes and ajustes.logo %}
          <img src="{{ ajustes.logo.url }}" alt="{{ ajustes.nombre_marca }}">
        {% else %}
          <h2 style="margin:0;">{{ ajustes.nombre_marca|default:"Betel Casa de Dios" }}</h2>
        {% endif %}
      </div>
    </div>

    <!-- FILTRO 1: GÉNERO -->
    <div class="filters" style="margin-top:18px;">
      <span class="label">Género</span>
      <a class="chip {% if not genero %}active{% endif %}" href="/?{% if tipo %}tipo={{ tipo }}{% endif %}">Todos</a>
      {% for gval,glabel in generos %}
        <a class="chip {% if genero == gval %}active{% endif %}" href="/?genero={{ gval }}{% if tipo %}&tipo={{ tipo }}{% endif %}">{{ glabel }}</a>
      {% endfor %}
    </div>

    <!-- FILTRO 2: TIPO -->
    <div class="filters">
      <span class="label">Tipo</span>
      <a class="chip {% if not tipo %}active{% endif %}" href="/?{% if genero %}genero={{ genero }}{% endif %}">Todo</a>
      {% for tval,tlabel in tipos %}
        <a class="chip {% if tipo == tval %}active{% endif %}" href="/?{% if genero %}genero={{ genero }}&{% endif %}tipo={{ tval }}">{{ tlabel }}</a>
      {% endfor %}
    </div>

    <!-- PRODUCTOS -->
    <div class="grid">
      {% for producto in productos %}
        <a class="card" href="{% url 'store:detalle_producto' producto.id %}">
          <div class="imgbox">
            {% with foto=producto.imagenes.first %}
              {% if foto %}
                <img src="{{ foto.imagen.url }}" alt="{{ producto.nombre }}">
              {% endif %}
            {% endwith %}
          </div>
          <div class="p">
            <p class="title">{{ producto.nombre }}</p>
            <p class="price">$ {{ producto.precio|cop }}</p>
          </div>
        </a>
      {% empty %}
        <p style="color:var(--muted);">No hay productos activos aún.</p>
      {% endfor %}
    </div>

    {% if ajustes and ajustes.texto_marca %}
      <div class="section">
        <h3>Nuestra promesa</h3>
        <p>{{ ajustes.texto_marca }}</p>
      </div>
    {% endif %}

    <div class="footer">
      <div><b>Contacto:</b> WhatsApp {{ ajustes.whatsapp_numero|default:"573001099123" }} · Atención {{ ajustes.horario_atencion|default:"24/7" }}</div>
      <div><b>Producción:</b> {{ ajustes.dias_produccion|default:"3 días" }} · <b>Envíos:</b> {{ ajustes.envio_tiempo|default:"3 a 5 días hábiles" }}</div>
      <div>{{ ajustes.envio_nota|default:"" }}</div>
    </div>
  </div>

  <a class="wpp" target="_blank" href="https://wa.me/{{ ajustes.whatsapp_numero|default:'573001099123' }}">WhatsApp</a>

  <!-- MODAL T&C -->
  <div id="modalBack" class="modal-back">
    <div class="modal">
      <h2>Términos y condiciones</h2>
      <div class="txt">
        {% if ajustes and ajustes.terminos_html %}
          {{ ajustes.terminos_html }}
        {% else %}
          Debes aceptar los términos y condiciones para continuar.
        {% endif %}
      </div>
      <div class="row">
        <button class="btn" onclick="rechazar()">No acepto</button>
        <button class="btn primary" onclick="aceptar()">Acepto</button>
      </div>
    </div>
  </div>

  <script>
    const KEY = "betel_acepto_tyc_v1";

    function aceptar(){
      localStorage.setItem(KEY, "1");
      document.getElementById("modalBack").style.display = "none";
    }
    function rechazar(){
      document.body.innerHTML = "<div style='font-family:Arial;padding:30px;color:#111;background:#fff;min-height:100vh;'><h2>Para continuar debes aceptar los términos y condiciones.</h2></div>";
    }

    (function(){
      const ok = localStorage.getItem(KEY) === "1";
      if(!ok){
        document.getElementById("modalBack").style.display = "flex";
      }
    })();
  </script>
</body>
</html>
